<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MEC</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Contenedor de informaci√≥n de visitas, fecha y hora -->
  <div id="info-container">
      <p><span id="hora"></span>    <span id="fecha"></span>         Visitas: <span id="contador">0</span></p>
      <button id="resetContador" class="hidden-reset" onclick="resetContador()">Resetear Contador</button>
  </div>
  <!-- Pantalla de Login -->
  <div id="login-container">
      <div class="logo-container">
          <img src="logo.png" alt="Logotipo de MEC">
      </div>

      <!-- Estructura de bienvenida -->
      <div id="introBienvenida" class="intro-container" style="display: none;">
          <p><strong>Esta aplicaci√≥n te ayuda a revisar si tu sueldo y derechos laborales est√°n bien calculados.</strong></p>
          <p>Analiza tu liquidaci√≥n, vacaciones, finiquito, horas extras, rec.dom y ext.dom en pocos minutos.</p>
          <p>Tienes acceso a Utilidades, Chat Grupal o Privado</p>
          <p>Sube tu archivo PDF. Todo es privado y an√≥nimo.</p>
          <button id="btnSolicitarClave">Solicita tu clave</button>
          <hr>
          <button id="btnEntendido">Entendido</button>
      </div>

      <!-- Modal con el correo de solicitud de clave -->
      <div id="modalClave" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
        background-color:rgba(0,0,0,0.5); text-align:center; padding-top:100px;">
        <div style="background:#fff; display:inline-block; padding:20px; border-radius:8px;">
          <p>Env√≠a tu solicitud a este correo:</p>
          <strong>fetrahfal1999@gmail.com</strong>
          <br><br>
          <button onclick="document.getElementById('modalClave').style.display='none'">Cerrar</button>
        </div>
      </div>

      <h1>Bienvenido a MEC</h1>
      <p class="left-align">Ingresa clave de acceso:</p>
      <input type="password" id="codigoAcceso" maxlength="8" placeholder="8 d√≠gitos o letras" autocomplete="off" />
      <button type="button" id="ingresarBtn">Ingresar</button>
      <p id="mensajeError" class="error-msg" style="display: none;">C√≥digo incorrecto. Intenta nuevamente.</p>
  </div>

  <!-- Men√∫ Principal -->
  <div id="menu-principal" class="pantalla" style="display: none;">
      <div class="logo-container">
          <img src="logo.png" alt="Logotipo de MEC">
      </div>
      <h1>Men√∫ Principal</h1>
      <button onclick="mostrarPantalla('pantalla-analisis')">üî• An√°lisis de Liquidaci√≥n</button>
      <button onclick="mostrarPantalla('pantalla-vacaciones')">üåä C√°lculo de Vacaciones</button>
      <button onclick="mostrarPantalla('screen-finiquito')">üëã C√°lculo de Finiquito</button>
      <button onclick="mostrarPantalla('pantalla-horas')">‚è≥ C√°lculo de Horas</button>
      <button onclick="mostrarPantalla('pantalla-recursos')">‚úÖ Recursos √ötiles</button>
      <button onclick="ingresarAlChat()">üì¢ Chat Grupal y Privado</button>
      <button onclick="mostrarPantalla('pantalla-archivosindical')">üìÇ Archivo Sindical</button>
      <button onclick="salirAplicacion()">Salir de la Aplicaci√≥n</button>
  </div>

  <!-- ++++++++++++++++++++++ las otras funciones originales +++++++++++++++++++++++-->
  <!-- Pantalla de An√°lisis de Liquidaci√≥n -->
  <div id="pantalla-analisis" class="pantalla" style="display: none;">
      <h1>An√°lisis de Liquidaci√≥n</h1>
      <p><strong><em>* A partir Mayo 2024, la jornada m√°xima es de 44 horas.*</em></strong></p>
      <label for="jornada">Elige tu jornada laboral </label>
      <select id="jornada" required>
          <option value="">Selecciona la jornada</option>
          <option value="45">Completa (45 horas)</option>
          <option value="44" selected>Completa (44 horas)</option>
          <option value="43">Completa (43 horas)</option>
          <option value="42">Completa (42 horas)</option>
          <option value="41">Completa (41 horas)</option>
          <option value="40">Completa (40 horas)</option>
          <option value="30">Parcial (30 hrs)</option>
          <option value="25">Parcial (25 hrs)</option>
          <option value="20">Parcial (20 hrs)</option>
          <option value="18">Parcial (18 hrs)</option>
      </select>
      <p><label for="fileInput">Ingresa una liquidaci√≥n de sueldo en formato PDF</label></p>
      <input type="file" id="fileInput">
      <p>
        <label for="filePremio">(Opcional) Subir Informe "Premio de Venta" (Reporte Resumen):</label>
        <input type="file" id="filePremio" accept="application/pdf">
      </p>
      
      <!-- Bot√≥n para activar ingreso manual -->
<button id="btnIngresoManual" style="margin-top:10px; background:#4CAF50; color:white;">
    Ingresar datos manuales de Reporte de Ventas
</button>

<!-- Formulario Manual (inicialmente oculto) -->
<div id="formularioManual" style="display:none; margin-top:20px; border:1px solid #ccc; padding:15px; border-radius:8px;">
    <h3>Ingreso Manual de Datos</h3>

    <label for="manualHorasAsesor">Horas trabajadas por el asesor:</label>
    <input type="number" id="manualHorasAsesor" placeholder="Ej: 160">

    <label for="manualHorasDepto">Horas totales del departamento:</label>
    <input type="number" id="manualHorasDepto" placeholder="Ej: 450">

    <label for="manualVentaTienda">Venta tienda total:</label>
    <input type="number" id="manualVentaTienda" placeholder="Ej: 145000000">

    <label for="manualPorcentaje">Porcentaje tienda (decimal):</label>
    <input type="number" step="0.001" id="manualPorcentaje" placeholder="Ej: 0.26">

    <button id="btnCalcularManual" style="margin-top:15px; background:#1976D2; color:white;">
        Calcular Comisi√≥n Manual
    </button>
</div>

      <button onclick="analizarArchivo()">Calcular</button>
      <button onclick="mostrarPantalla('menu-principal')">‚Ü© Menu</button>
      <div id="resultadoAnalisis"></div>
      <div class="container gratificacion-container" id="gratificacionMec" style="display: none;">
          <h3>Gratificaci√≥n Mec</h3>
          <div id="listaGratificables"></div>
      </div>
      <div class="container" id="resultadoGratificacion"></div>
      <button id="refrescarBtnAnalisis">Borrar</button>
  </div>
  
  <!-- Pantalla de Vacaciones -->
  <div id="pantalla-vacaciones" class="pantalla" style="display: none;">
      <h2>C√°lculo de Vacaciones</h2>
      <p>Sube los siguientes archivos:</p>
      <ul>
          <li>1 PDF con el pago de vacaciones</li>
          <li>3 a 6 PDFs con al menos 27 d√≠as trabajados</li>
      </ul>
      <p class="alerta">No subir liquidaciones con ausencias por licencias m√©dicas o permisos sin goce de sueldo.</p>
      <input type="file" id="vacacionInput" multiple>
      <button id="calcularVacacionesBtn">Calcular Vacaciones</button>
      <button id="volverBtn" onclick="mostrarPantalla('menu-principal')">‚Ü© Menu</button>
      <div id="resultadoVacaciones"></div>
      <button id="refrescarBtnVacaciones">Borrar</button>
  </div>
  <!-- Pantalla de Finiquito -->
  <div id="screen-finiquito" class="pantalla" style="display: none;">
      <h2>C√°lculo de Finiquito</h2>
      <label for="fechaInicioContrato">Fecha de Inicio de Contrato:</label>
      <input type="date" id="fechaInicioContrato" required>
      <label for="fechaDesvinculacion">Fecha de Desvinculaci√≥n:</label>
      <input type="date" id="fechaDesvinculacion" required>
      <label for="diasTrabajadosUltimoMes">Ingrese d√≠as trabajados en el ultimo mes:</label>
      <input type="number" id="diasTrabajadosUltimoMes" placeholder="D√≠as trabajados en el √∫ltimo mes" />
      <div>
          <label for="diasVacacionesPendientes">Ingrese d√≠as de vacaciones pendientes:</label>
          <input type="number" id="diasVacacionesPendientes" placeholder="D√≠as pendientes">
      </div>
      <input type="file" id="fileFiniquito" multiple accept="application/pdf">
      <button id="calcularFiniquito">Calcular</button>
      <button class="backBtn" data-target="menu-principal">‚Ü© Menu</button>
      <div id="resultadosFiniquito" class="result-container hidden"></div>
      <div id="resultadosNoFiniquito" class="hidden"></div>
      <button id="refrescarFiniquito">Borrar</button>
  </div>

  <!-- Pantalla de C√°lculo de Horas -->
  <div id="pantalla-horas" class="pantalla">
      <h1>C√°lculo de Horas</h1>
      <!-- Datos de entrada -->
      <label for="horas-sueldoBase">Sueldo Base:</label>
      <input type="number" id="horas-sueldoBase" placeholder="Ingrese su sueldo base">
      <label for="horas-jornada">Jornada Laboral:</label>
      <select id="horas-jornada">
          <option value="">Selecciona la jornada</option>
          <option value="45">45 horas</option>
          <option value="44" selected>44 horas</option>
          <option value="43">43 horas</option>
          <option value="42">42 horas</option>
          <option value="41">41 horas</option>
          <option value="40">40 horas</option>
          <option value="30">30 horas</option>
          <option value="25">25 horas</option>
          <option value="20">20 horas</option>
          <option value="18">18 horas</option>
      </select>
      <label for="horas-horasExtras">Horas Extras Realizadas:</label>
      <input type="number" id="horas-horasExtras" placeholder="Ingrese cantidad de horas extras">
      <label for="horas-horasRecargoDomingo">Horas Recargo Domingo:</label>
      <input type="number" id="horas-horasRecargoDomingo" placeholder="Ingrese cantidad de horas con recargo">
      <label for="horas-horasExtrasDomingo">Horas Extras Domingo:</label>
      <input type="number" id="horas-horasExtrasDomingo" placeholder="Ingrese cantidad de horas extras en domingo">

      <!-- Botones de acci√≥n -->
      <button onclick="calcularHoras()">Calcular</button>
      <button onclick="mostrarPantalla('menu-principal')">‚Ü© Men√∫</button>
      <button onclick="refrescarHoras()">Borrar</button>
      <!-- Resultados -->
      <div id="horas-resultado">
          <p>üìå Factor de Horas Extras Utilizado: <span id="horas-factor"></span></p>
          <p>üí∞ Valor Hora Base: <span id="horas-valorHoraBase"></span></p>
          <p>‚è≥ Valor Horas Extras: <span id="horas-valorHorasExtras"></span></p>
          <p>üåû Valor Recargo Domingo: <span id="horas-valorRecargoDomingo"></span></p>
          <p>üî• Valor Horas Extras Domingo: <span id="horas-valorHorasExtrasDomingo"></span></p>
      </div>
  </div>

  <!-- Pantalla de Chat -->
  <div id="pantalla-chat" class="pantalla" style="display: none;">
      <h1>Chat MEC</h1>
      <div id="mensaje-chat">
          <!-- Los mensajes se mostrar√°n aqu√≠ -->
      </div>
      <textarea id="mensajeUsuario" rows="4" placeholder="Escribe aqu√≠..." required></textarea>
      <button id="enviarMensajeBtn">Enviar mensaje</button>
      <p id="confirmacionEnvio" style="display:none; color: green;">‚úÖ ¬°Mensaje enviado!</p>
      <button id="cambiarNickBtn">Cambiar mi Nick</button>
      <!-- Botones de chat privado -->
          <div id="botones-chat-privado">
              <button onclick="iniciarChatPrivado()" id="btnChatPrivado">üó®Ô∏è Chat Privado</button>
              <button onclick="mostrarPantallaAdminChat()" id="btnAdminChatPrivado" style="display:none;">üëë Chat Privado Admin</button>
          </div>
      <button onclick="mostrarPantalla('menu-principal')">‚Ü© Men√∫</button>
  </div>

  <!-- Pantalla de Chat Privado (Usuario) -->
  <div id="pantalla-chat-privado" class="pantalla" style="display:none;">
      <h1>Chat con Admin</h1>
      <div id="mensaje-chat-privado" class="chat-container"></div>
      <textarea id="mensajeUsuarioPrivado" rows="3" placeholder="Escribe tu mensaje privado..."></textarea>
      <button id="enviarMensajePrivadoBtn">Enviar Mensaje</button>
      <p id="confirmacionEnvioPrivado" style="display:none; color: green;">‚úÖ ¬°Mensaje enviado!</p>
      <button onclick="mostrarPantalla('pantalla-chat')">üí¨ Volver al Chat Grupal</button>
      <button onclick="volverAlMenu()">‚Ü© Men√∫</button>
  </div>

  <!-- Pantalla de Admin para gestionar chats privados -->
  <div id="pantalla-admin-chat" class="pantalla" style="display:none;">
      <h1>Chats Privados</h1>
      <p id="contador-conversaciones" style="font-weight: bold; margin-bottom: 10px;"></p>
      <div id="lista-conversaciones"></div>
      <hr>
      <div id="chat-admin-panel" style="display:none;">
          <h2>Usuario: <span id="nombreUsuarioChat"></span></h2>
          <div id="admin-chat-mensajes" class="chat-container" style="overflow-y:auto; max-height:400px;"></div>
          <textarea id="mensajeAdminPrivado" rows="3" placeholder="Responder..."></textarea>
          <button onclick="enviarMensajePrivadoAdmin()">Enviar Respuesta</button>
          <button onclick="cerrarConversacion()">‚ùå Cerrar Conversaci√≥n</button>
          <hr>
          <div class="botones-admin-chat">
              <button onclick="mostrarListaConversaciones()">üó® Volver a Lista de Chats</button>
              <button onclick="mostrarPantalla('pantalla-chat')">üí¨ Volver al Chat Grupal</button>
              <button onclick="mostrarPantalla('menu-principal')">‚Ü© Men√∫</button>
          </div>
      </div>
      <!-- Secci√≥n cuando no hay conversaciones activas -->
      <div id="sin-conversaciones-activa" style="display:none;">
          <p>Actualmente no hay conversaciones activas.</p>
          <button onclick="mostrarPantalla('pantalla-chat')">üí¨ Volver al Chat Grupal</button>
          <button onclick="mostrarPantalla('menu-principal')">‚Ü© Men√∫</button>
      </div>
  </div>

  <!-- Nueva Pantalla de Recursos -->
  <div id="pantalla-recursos" class="pantalla" style="display: none;">
      <h1>Recursos √ötiles</h1>
      <ul>
      <li><a href="https://access-key-corp.falabella.tech/auth/realms/esti/protocol/openid-connect/auth?client_id=mi-falabella&redirect_uri=https%3A%2F%2Fmi.falabella.com%2F%23%2Fauth%2F%3FskipRedirect%3Dtrue&state=57f0187e-40af-4fdf-8064-3d1dfff0ee1d&response_mode=fragment&response_type=code&scope=openid&nonce=d95e0f89-b50c-4bd1-8f90-a5dbb528d479&code_challenge=cC9EmYJOJfG1K9h8wCvmGpHUSkvIWcBiDncldUEeKFg&code_challenge_method=S256" target="_blank">Mi.Falabella.com</a></li>
      <li><a href="https://falaweb.falabella.com/" target="_blank">Falaweb Falabella (Descarga tu PDF)</a></li>
      <li><a href="https://portal.beneficios.falabella.com/" target="_blank">Beneficios Falabella (clave Falanet)</a></li>
      <li><a href="https://portalf.cl/convenios-y-beneficios/" target="_blank">Portal: Convenios y Beneficios</a></li>
      <li><a href="https://ca.clinicavirtual.com/meimportas" target="_blank">Meimportas (Seg. FAlabella)</a></li>
      <li><a href="https://canaldeintegridad.ines.cl/falabella/" target="_blank">Canal de Integridad Falabella</a></li>
      <li><a href="https://vbench.virtuaresearch.com/IR/IAC/?ticker=SACI&exchange=SANTIAGO" target="_blank">Centro de an√°lisis interactivo Falabella</a></li>
      <li><a href="https://www.facebook.com/fetrahfal/?locale=es_LA" target="_blank">Facebook Fetrahfal</a></li>
      <hr><li><a href="Documento P√∫blico General/Datos/Cod Trab ene24.pdf" target="_blank"> üìÑ Ver C√≥digo del Trabajo 2024</a></li>
      <li><a href="https://www.dt.gob.cl/legislacion/1624/w3-article-95516.html" target="_blank">Descargar C√≥digo del Trabajo</a></li>
      <li><a href="https://www.dt.gob.cl/portal/1626/w3-channel.html" target="_blank">Direcci√≥n del Trabajo</a></li>
      <li><a href="https://www.dt.gob.cl/portal/1626/w3-article-99712.html" target="_blank">DT-Organizacion Sindical Base</a></li>
          <li><a href="https://tramites.dirtrab.cl/ventanillarrll/ingreso2.aspx" target="_blank">DT-Ventanilla Sindical</a></li>
      <li><a href="https://www.dt.gob.cl/portal/1626/w3-propertyname-2556.html" target="_blank">DT-Ley de 40 horas</a></li><hr>
      <li><a href="https://mi3.chileatiende.gob.cl/micha/inicio" target="_blank">Mi Chileatiende</a></li>
      <li><a href="https://nuevo.fonasa.gob.cl/" target="_blank">FONASA</a></li>
      <li><a href="https://milicenciamedica.cl/cotizante/" target="_blank">COMPIN</a></li>
      <li><a href="https://www.sii.cl/valores_y_fechas/utm/utm2024.htm" target="_blank">Servicio de Impuestos Internos</a></li>
      <li><a href="https://calculadoraipc.ine.cl/" target="_blank">Calculadora de IPC</a></li>
      <li><a href="https://www.pjud.cl/home" target="_blank">Poder Judicial</a></li><hr>
      </ul>
      <button onclick="mostrarPantalla('menu-principal')">‚Ü© Men√∫</button>
  </div>

  <!-- Nueva Pantalla archivos sindical -->
  <div id="pantalla-archivosindical" class="pantalla" style="display: none;">
      <h1>Archivo Sindical</h1>
      <p>Archivo Sindicatos, Documentos Federaci√≥n y Datos.</p>
      <!-- Lista desplegable para seleccionar sindicato -->
      <select id="select-sindicato" onchange="mostrarClaveInput()">
          <option value="" selected>Selecciona un Sindicato</option>
          <option value="Concepcion">Sindicato Concepci√≥n</option>
          <option value="Costanera">Sindicato Costanera</option>
          <option value="Curico">Sindicato Curic√≥</option>
          <option value="Iquique">Sindicato Iquique</option>
          <option value="PlazaNorte">Sindicato Plaza Norte</option>
          <option value="PuertoMontt">Sindicato Puerto Montt</option>
          <option value="Rancagua">Sindicato Rancagua</option>
          <option value="Trebol">Sindicato Trebol</option>
      </select>
      <!-- Modal para ingresar la clave -->
      <div id="modal-clave" class="modal oculto">
          <div class="modal-contenido">
              <h3>Ingrese la clave de acceso</h3>
              <label for="clave-input">Clave:</label>
              <input type="password" id="clave-input" required autocomplete="new-password" placeholder="8 d√≠gitos o letras">
              <button type="button" onclick="verificarClave()">Aceptar</button>
              <button type="button" onclick="cerrarModalClave()">Cancelar</button>
              <p id="mensaje-error" class="error-msg oculto"></p>
          </div>
      </div>
      <!-- Bot√≥n Volver al men√∫ -->
      <button onclick="mostrarPantalla('menu-principal')">‚Ü© Men√∫</button>
  </div>
  <!-- Pantalla de documentos (mostrar solo despu√©s de ingresar la clave correctamente) -->
  <div id="pantalla-documentos" class="pantalla" style="display: none;">
      <h2 id="nombre-sindicato"></h2>
      <ul id="lista-documentos-sindicato"></ul>
      <h3>Documentos Federaci√≥n</h3>
      <ul id="lista-documentos-publicos"></ul>
      <h3>Documentos Interesantes</h3>
      <ul id="lista-documentos-varios"></ul>
      <button onclick="mostrarPantalla('menu-principal')">‚Ü© Men√∫</button>
  </div>

    <!-- (Opcional) Favicon vac√≠o para evitar error 404 -->
  <link rel="icon" href="data:,">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script type="module">import { v4 as uuidv4 } from 'https://cdn.skypack.dev/uuid';</script>
  <script type="module" src="supabaseClient.js"></script>
  <!--script type="module" src="tesoreriaApp.js"></script-->
  <!--script src="menu_general.js"></script-->
  <script src="global.js"></script>
  <script src="script.js"></script>
</body>
</html>
